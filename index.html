<!DOCTYPE html>
    <html lang="en">
    <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Schrödinger's AI</title>
    <style>
      :root {
        --bg:#ffffff; --fg:#111111; --muted:#777777; --line:#111111;
        --stripe:#fafafa; --th:#f8f8f8;
        /* theme-able vars (will be overridden per tab) */
        --bar-fill:#111111;
        --alive-bg:#111111; --alive-fg:#ffffff;
        --da-bg:#555555;    --da-fg:#ffffff;
        --dead-bg:#DDDDDD;  --dead-fg:#111111;
      }
      html,body{background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,system-ui,sans-serif;margin:0;padding:0;}
      header{border-bottom:2px solid var(--line);padding:16px 24px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;}
      h1{margin:0;font-size:20px;line-height:1.2;display:flex;align-items:center;gap:8px;font-weight:700;}
      .muted{color:var(--muted);font-weight:400;} .small{font-size:12px;}
      main{max-width:1100px;margin:0 auto;padding:20px 24px 14px;}
      section+section{margin-top:28px;} h2{font-size:16px;margin:0 0 10px 0;font-weight:700;}

      .tabs{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;}
      .tab-btn{border:1px solid var(--line);background:#fff;padding:6px 12px;border-radius:999px;font-size:13px;cursor:pointer;user-select:none;}
      .tab-btn[aria-selected="true"]{background:#111;color:#fff;}

      .top-grid{display:grid;grid-template-columns:1.2fr 0.8fr;gap:16px;}
      .bars{border:1px solid var(--line);border-radius:8px;padding:12px;background:#fff;}
      .bar-row{display:grid;grid-template-columns:1fr 4fr auto;gap:10px;align-items:center;margin:8px 0;}
      .bar-label{font-weight:600;}
      .bar-track{position:relative;height:10px;background:var(--stripe);border:1px solid var(--line);}
      .bar-fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:var(--bar-fill);}
      /* Previous-week ghost marker (subtle) */
      .bar-prev-marker{position:absolute;top:-2px;bottom:-2px;width:2px;background:#888;opacity:0.6;}

      .grid3{display:grid;grid-template-columns:1fr;gap:14px;}
      .card{border:1px solid var(--line);border-radius:8px;padding:12px;background:#fff;}
      .pill{display:inline-block;padding:2px 10px;border-radius:999px;font-size:12px;line-height:1.5;font-weight:600;white-space:nowrap;}
      .pill.alive{background:var(--alive-bg);color:var(--alive-fg);}
      .pill.da{background:var(--da-bg);color:var(--da-fg);}
      .pill.dead{background:var(--dead-bg);color:var(--dead-fg);}

      ul.slim{list-style:none;margin:8px 0 0;padding:0;columns:2;column-gap:16px;}
      ul.slim li{break-inside:avoid;padding:4px 0;font-size:14px;}

      .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:6px 0 8px;}
      .search-input{border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:13px;min-width:200px;}

      table{width:100%;border-collapse:collapse;margin:10px 0 16px;}
      th,td{border:1px solid var(--line);padding:8px 10px;text-align:left;vertical-align:middle;font-size:14px;}
      th{background:var(--th);user-select:none;cursor:pointer;}
      tbody tr:nth-child(even){background:var(--stripe);}
      .right{text-align:right;} .center{text-align:center;}

      .footnote{color:var(--muted);font-size:12px;line-height:1.5;border:1px dashed var(--line);border-radius:8px;padding:10px 12px;background:#fff;}
      .fn-block{margin-top:8px;} .fn-list{margin:6px 0 0 0;padding-left:16px;} .fn-list li{margin:4px 0;}
      .pill.legend{font-size:11px;padding:1px 8px;}

      .arrow{font-size:11px;margin-right:6px;}
      .arrow.up{color:#111;} .arrow.down{color:#777;} .arrow.flat{color:var(--muted);}

      footer{border-top:2px solid var(--line);padding:12px 24px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;}
      .links a{color:var(--fg);text-decoration:underline 1px;}
      .links a:hover{text-decoration-thickness:2px;}
    </style>
    </head>
    <body>
      <header>
        <h1><img src="schroedinger_40x40.png" alt="Logo" style="height:28px;vertical-align:middle;margin-right:12px;border:1px solid #111;padding:3px;border-radius:4px;background:#fff"/>Schrödinger's AI <span id="asof" class="muted small"></span></h1>
        <div class="links">
          <a href="https://twoquants.substack.com/" target="_blank" rel="noopener noreferrer">Substack</a> ·
          <a href="https://x.com/schroedingersai" target="_blank" rel="noopener noreferrer">X (Twitter)</a>
        </div>
        <div class="pill" id="counts">–</div>
      </header>

      <main>
        <div class="tabs" id="tabs"></div>

        <section class="top-grid">
          <div class="bars">
            <h2>Current Allocation</h2>
            <div id="bars-wrap"></div>
          </div>
          <div>
            <h2>Status</h2>
            <div class="grid3">
              <div class="card">
                <div class="pill alive">Alive</div>
                <ul id="list-alive" class="slim"></ul>
              </div>
              <div class="card">
                <div class="pill da">Dead and Alive</div>
                <ul id="list-da" class="slim"></ul>
              </div>
              <div class="card">
                <div class="pill dead">Dead</div>
                <ul id="list-dead" class="slim"></ul>
              </div>
            </div>
          </div>
        </section>

        <section>
          <h2>Allocation Details</h2>

          <div class="controls">
            <input id="asset-search" class="search-input" type="search" placeholder="Search asset… (e.g., EFA, BTCUSD)" />
          </div>

          <table id="tbl-weights">
            <thead>
              <tr>
                <th data-sort="asset">Asset</th>
                <th data-sort="state">State</th>
                <th data-sort="alloc" class="center">Allocation</th>
                <th data-sort="weight" class="right">Weight</th>
                <th data-sort="delta" class="right">Δ weight</th>
                <th data-sort="expected" class="right">Fwd Return</th>
                <th data-sort="conf" class="right">Confidence</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <div class="footnote">
            A ✓ in “Allocation” marks assets currently held (weight &gt; 0).
            <div class="fn-block">
              <strong>Schrödinger logic (empirical similarity):</strong>
              <ul class="fn-list">
                <li><span class="pill legend alive">Alive</span> — strong historical precedent; many close analogues align; expected forward move is meaningfully positive (or negative, if shorts allowed).</li>
                <li><span class="pill legend dead">Dead</span> — inconclusive precedent; too few or inconsistent analogues; better to stay flat.</li>
                <li><span class="pill legend da">Dead &amp; Alive</span> — conflicting precedent; some analogues up, others down; model flags uncertainty (sometimes the smartest decision is to wait).</li>
              </ul>
            </div>
            <div class="fn-block">
              “Fwd Return” is the model's probability weighted forward return over the next 4-12 week; “Confidence” is the model's conviction in that projection.
            </div>
          </div>
        </section>
      </main>

      <footer>
        <div class="links">
          <a id="imprint-link" href="https://twoquants.com/imprint/" target="_blank" rel="noopener noreferrer">Imprint</a>
        </div>
        <div class="links">
          <a href="https://twoquants.substack.com/" target="_blank" rel="noopener noreferrer">Substack</a> ·
          <a href="https://x.com/schroedingersai" target="_blank" rel="noopener noreferrer">X (Twitter)</a>
        </div>
      </footer>

      <script id="payload-macro" type="application/json">{"generated_utc": "2025-10-05T14:25:21Z", "weights_time": "2025-10-03", "weights": {"XLE": 0.19228303944098152, "EEM": 0.014943025941419502, "LQD": 0.17241387510262113, "IEF": 0.21302832757011247, "IWM": 0.0714313828820614, "TLT": 0.08642433060245783, "HYG": 0.21712433884097176, "IWMO": 0.022396677441889664, "CASH": 0.009955002177484684}, "prev_weights_time": "2025-09-26", "prev_weights": {"EFA": 0.03206899521178989, "EEM": 0.038780912589071646, "LQD": 0.2589560758382635, "IEF": 0.26948805676272963, "TLT": 0.08642433060245783, "HYG": 0.26679375534273403, "IWMO": 0.04748787365295353, "CASH": 0.0}, "alive": ["ACWI", "ACWV", "CEW", "DBA", "DBMF", "EEM", "EFA", "EMB", "EWJ", "EZU", "FXE", "FXI", "FXY", "GLD", "HYG", "IBIT", "IEF", "IWM", "IWMO", "LQD", "MTUM", "PAVE", "QQQ", "QUAL", "SHY", "SLV", "SPY", "TIP", "TLT", "UUP", "VGK", "VNQ", "XLE", "XLF", "XLK"], "dead": ["CPER", "DBC", "EWZ", "PSP", "RSP", "URNM", "USO", "VLUE", "XLY"], "meta": {"ACWI": {"state": "Alive (candidate)", "confirm": true, "strength": 0.18524711985364828, "s": 0.08143501987346012, "view_blend": 0.008857287009640412, "view_conf": 0.5815656565656565}, "ACWV": {"state": "Alive (candidate)", "confirm": true, "strength": 0.23504614505888544, "s": 0.05981148006154116, "view_blend": 0.010163645624392884, "view_conf": 0.8555555555555555}, "CEW": {"state": "Alive (confirmed)", "confirm": true, "strength": -0.33919398197884076, "s": 0.030203414904614298, "view_blend": 0.00896880518835219, "view_conf": 0.9111111111111111}, "CPER": {"state": "Dead", "confirm": false, "strength": 0.037256934621328064, "s": 0.016101933131016575, "view_blend": -0.048299198440012396, "view_conf": 0.20683760683760685}, "DBA": {"state": "Alive (candidate)", "confirm": true, "strength": 0.19588468008995497, "s": 0.03226327743635603, "view_blend": 0.011574926026061808, "view_conf": 0.6047619047619047}, "DBC": {"state": "Dead", "confirm": false, "strength": 0.5461526160621635, "s": 0.09097459894383529, "view_blend": 0.0008705994190796677, "view_conf": 0.49966329966329964}, "DBMF": {"state": "Alive (candidate)", "confirm": true, "strength": 0.2516016844652007, "s": 0.09598047583769563, "view_blend": 0.010037560511434116, "view_conf": 0.6232323232323232}, "EEM": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.5712683426497338, "s": 0.036769392172484754, "view_blend": 0.025456876815042752, "view_conf": 0.7222222222222222}, "EFA": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.06046848727620446, "s": 0.0647360779947504, "view_blend": 0.02071152812591803, "view_conf": 0.8868686868686869}, "EMB": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.49430083454764695, "s": 0.10223921786798469, "view_blend": 0.020096718367226075, "view_conf": 0.9083333333333333}, "EWJ": {"state": "Alive (candidate)", "confirm": true, "strength": 0.10458735771638317, "s": 0.030691493019275044, "view_blend": 0.0012118253164691288, "view_conf": 0.6102564102564102}, "EWZ": {"state": "Dead", "confirm": false, "strength": 0.6039785502414814, "s": 0.1252288147586786, "view_blend": 0.0003870699337958326, "view_conf": 0.582905982905983}, "EZU": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.5548290126619391, "s": 0.1232949095307858, "view_blend": 0.018138747492584616, "view_conf": 0.7000777000777001}, "FXE": {"state": "Alive (candidate)", "confirm": true, "strength": 0.1365074473965464, "s": 0.010164200163146056, "view_blend": 0.005970940236157116, "view_conf": 0.7230769230769232}, "FXI": {"state": "Alive (confirmed)", "confirm": true, "strength": 1.081947887227971, "s": 0.05891154529060552, "view_blend": 0.040210008331529545, "view_conf": 0.8002525252525253}, "FXY": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.9464323512044366, "s": 0.10241753212011392, "view_blend": 0.02274477880080309, "view_conf": 0.8134680134680133}, "GLD": {"state": "Alive (candidate)", "confirm": true, "strength": 0.20780433653952457, "s": 0.04995174614171648, "view_blend": 0.042990697891698744, "view_conf": 0.7888888888888889}, "HYG": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.5799529711203506, "s": 0.158256736261713, "view_blend": 0.007134453072584991, "view_conf": 0.7867243867243867}, "IBIT": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.0, "s": null, "view_blend": 0.011683331186277596, "view_conf": 0.5737373737373738}, "IEF": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.8906760651231334, "s": 0.15695463421666928, "view_blend": 0.008288688383942361, "view_conf": 0.7314814814814814}, "IWMO": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.4934830797243268, "s": 0.0494522668169758, "view_blend": 0.010833077926936361, "view_conf": 0.7333333333333334}, "IWM": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.4000435369687554, "s": 0.09463586577686017, "view_blend": 0.006286597486383138, "view_conf": 0.6343434343434343}, "LQD": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.6834779598256489, "s": 0.14302364269385842, "view_blend": 0.01494628059704956, "view_conf": 0.8861111111111111}, "MTUM": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.45407511659993394, "s": 0.059255701129754326, "view_blend": 0.04650410404413507, "view_conf": 0.9777777777777779}, "PAVE": {"state": "Alive (candidate)", "confirm": true, "strength": 0.11072387081254109, "s": 0.08750504686663543, "view_blend": 0.0062913658876864904, "view_conf": 0.5707070707070706}, "PSP": {"state": "Dead", "confirm": false, "strength": 0.32523281818490823, "s": 0.05890776732722593, "view_blend": -0.010015025445494354, "view_conf": 0.3737373737373737}, "QQQ": {"state": "Alive (candidate)", "confirm": true, "strength": 0.14061763049506748, "s": 0.07883184833169854, "view_blend": 0.029323933675987176, "view_conf": 0.8641414141414141}, "QUAL": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.002214640011875657, "s": 0.05163385267497651, "view_blend": 0.005284317535078913, "view_conf": 0.6118686868686868}, "RSP": {"state": "Dead", "confirm": false, "strength": 0.29729390751826923, "s": 0.06300305918459585, "view_blend": -0.0017571620585677158, "view_conf": 0.5371212121212121}, "SHY": {"state": "Alive (confirmed)", "confirm": true, "strength": 1.1763654024017458, "s": 0.18889568542597018, "view_blend": 0.007559359693611714, "view_conf": 1.0}, "SLV": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.09652195981348788, "s": 0.01870076577516794, "view_blend": 0.039714666117498465, "view_conf": 0.5944444444444444}, "SPY": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.020888584465324822, "s": 0.057651389098498144, "view_blend": 0.007108563762513871, "view_conf": 0.5815656565656565}, "TIP": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.6498109805205794, "s": 0.07482639415848927, "view_blend": 0.006532571087528938, "view_conf": 0.7152958152958152}, "TLT": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.6270148918158565, "s": 0.1094603936837025, "view_blend": 0.004908394059994056, "view_conf": 0.5852813852813853}, "URNM": {"state": "Dead", "confirm": false, "strength": -0.2537532612812955, "s": 0.05492387903583414, "view_blend": 0.03936407576731853, "view_conf": 0.5371212121212121}, "USO": {"state": "Dead", "confirm": false, "strength": 0.241684199269107, "s": 0.10891692998213097, "view_blend": -0.03336407532247453, "view_conf": 0.15622895622895622}, "UUP": {"state": "Alive (candidate)", "confirm": true, "strength": 0.11905858754727294, "s": 0.048066478798309976, "view_blend": 0.00798000517193175, "view_conf": 0.6574074074074073}, "VGK": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.45904574405506504, "s": 0.09789490484303105, "view_blend": 0.022903799267994324, "view_conf": 0.9}, "VLUE": {"state": "Dead", "confirm": false, "strength": 0.5212363659960035, "s": 0.07729825467266907, "view_blend": -7.535772359905249e-05, "view_conf": 0.4292929292929293}, "VNQ": {"state": "Alive (candidate)", "confirm": true, "strength": 0.2145116903075619, "s": 0.05703467127230189, "view_blend": 0.005218160589887621, "view_conf": 0.5722222222222223}, "XLE": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.49487227683000645, "s": 0.1500861554532701, "view_blend": 0.0019991104677826114, "view_conf": 0.5606837606837607}, "XLF": {"state": "Alive (candidate)", "confirm": true, "strength": 0.13061721750347588, "s": 0.017534581370404864, "view_blend": 0.015506241904673214, "view_conf": 0.7866161616161617}, "XLK": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.006681157336734245, "s": 0.06991871264191699, "view_blend": 0.005582521834097674, "view_conf": 0.5703703703703703}, "XLY": {"state": "Dead", "confirm": false, "strength": 0.28443720399201733, "s": 0.07389552591496219, "view_blend": -0.023357832546252653, "view_conf": 0.45384615384615384}, "CASH": {"state": "Cash", "confirm": true, "strength": null, "s": null, "view_blend": null, "view_conf": null}}}</script><script id="links-macro" type="application/json">{"IBIT": "IBIT", "DBMF": "DBMF", "FXY": "FXY", "HYG": "HYG", "ACWV": "ACWV", "CPER": "CPER", "DBC": "DBC", "VGK": "VGK", "FXI": "FXI", "IWMO": "IS3R.DE", "GLD": "GLD", "IWM": "IWM", "EFA": "EFA", "PAVE": "PAVE", "XLY": "XLY", "SPY": "SPY", "QQQ": "QQQ", "XLE": "XLE", "MTUM": "MTUM", "SHY": "SHY", "VLUE": "VLUE", "FXE": "FXE", "DBA": "DBA", "SLV": "SLV", "VNQ": "VNQ", "USO": "USO", "LQD": "LQD", "TIP": "TIP", "EWZ": "EWZ", "IEF": "IEF", "EEM": "EEM", "XLF": "XLF", "ACWI": "ACWI", "UUP": "UUP", "EWJ": "EWJ", "QUAL": "QUAL", "EZU": "EZU", "CASH": "CASH", "TLT": "TLT", "PSP": "PSP", "URNM": "URNM", "EMB": "EMB", "CEW": "CEW", "RSP": "RSP", "XLK": "XLK"}</script><script id="theme-macro" type="application/json">{"bar": "rgba(47,58,70,0.25)", "alive_bg": "rgba(47,58,70,0.65)", "alive_fg": "#FFFFFF", "da_bg": "#6B7280", "da_fg": "#FFFFFF", "dead_bg": "#E5E7EB", "dead_fg": "#111111"}</script><script id="whitelist-macro" type="application/json">["ACWI", "DBC", "DBMF", "EEM", "EFA", "GLD", "HYG", "IEF", "IWM", "IWMO", "LQD", "QQQ", "SPY", "TLT", "USO", "UUP", "VNQ", "XLE", "XLF", "XLK"]</script><script id="payload-crypto" type="application/json">{"generated_utc": "2025-10-05T14:25:21Z", "weights_time": "2025-10-03", "weights": {"BTCUSD": 0.08658775857059019, "BNBUSD": 0.08658775857059019, "SOLUSD": 0.08658775857059019, "SUIUSD": 0.08658775857059019, "HYPEUSD": 0.08658775857059019, "CASH": 0.5670612071470491}, "prev_weights_time": "2025-09-26", "prev_weights": {"DOGEUSD": 0.06275187563724015, "XRPUSD": 0.06275187563724015, "BNBUSD": 0.06275187563724015, "SOLUSD": 0.06275187563724015, "SUIUSD": 0.06275187563724015, "HYPEUSD": 0.06275187563724015, "CASH": 0.623488746176559}, "alive": ["ADAUSD", "AVAXUSD", "BNBUSD", "BTCUSD", "HYPEUSD", "SOLUSD", "SUIUSD", "TRXUSD", "WIFUSD"], "dead": ["DOGEUSD", "ETHUSD", "LINKUSD", "PEPEUSD", "POPCATUSD", "XRPUSD"], "meta": {"ADAUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": -0.695221256002159, "s": 2.4342572023488143e-26, "view_blend": 0.024056243388957028, "view_conf": 0.5676767676767677}, "AVAXUSD": {"state": "Alive (candidate)", "confirm": true, "strength": -0.21985128264671816, "s": 2.640534348922108e-25, "view_blend": 0.156966080657062, "view_conf": 0.5737373737373738}, "BNBUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": -0.8790212789489888, "s": 1.6932489629820413e-21, "view_blend": 0.12226070657438466, "view_conf": 0.6398989898989899}, "BTCUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.3036884420566117, "s": 8.96658801401309e-21, "view_blend": 0.041241067425654684, "view_conf": 0.7313131313131312}, "DOGEUSD": {"state": "Dead", "confirm": false, "strength": -0.8649708074784188, "s": 1.9847665530179867e-25, "view_blend": 0.07375044768545706, "view_conf": 0.5447811447811447}, "ETHUSD": {"state": "Dead", "confirm": false, "strength": 0.19019660155312157, "s": 3.3567258823130798e-15, "view_blend": 0.08427590234557125, "view_conf": 0.5315656565656566}, "HYPEUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.0, "s": null, "view_blend": 0.2925470151829609, "view_conf": 0.6843434343434343}, "LINKUSD": {"state": "Dead", "confirm": false, "strength": -0.20306447195318156, "s": 3.5577992386839687e-20, "view_blend": 0.06322567091007858, "view_conf": 0.4833333333333334}, "PEPEUSD": {"state": "Dead", "confirm": false, "strength": 0.0, "s": null, "view_blend": -0.1921379920750774, "view_conf": 0.0}, "POPCATUSD": {"state": "Dead", "confirm": false, "strength": 0.0, "s": null, "view_blend": null, "view_conf": 0.0}, "SOLUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.5762240977231021, "s": 4.827137617700122e-34, "view_blend": 0.16018129575909862, "view_conf": 0.6713804713804713}, "SUIUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.9373149739319135, "s": 6.792185941823846e-25, "view_blend": 0.013362192571604562, "view_conf": 0.6262626262626262}, "TRXUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": 0.49318109612024563, "s": 1.5822652105024803e-19, "view_blend": 0.0484768409133519, "view_conf": 0.8888888888888888}, "WIFUSD": {"state": "Alive (confirmed)", "confirm": true, "strength": 2.606010312588492, "s": 6.870117576361465e-16, "view_blend": 0.12297293782527328, "view_conf": 0.6343434343434343}, "XRPUSD": {"state": "Dead", "confirm": false, "strength": -0.5610470410407067, "s": 5.958652754004666e-26, "view_blend": -0.00803795244085383, "view_conf": 0.4478114478114478}, "CASH": {"state": "Cash", "confirm": true, "strength": null, "s": null, "view_blend": null, "view_conf": null}}}</script><script id="links-crypto" type="application/json">{"DOGEUSD": "DOGE-USD", "XRPUSD": "XRP-USD", "POPCATUSD": "POPCAT31358-USD", "SOLUSD": "SOL-USD", "AVAXUSD": "AVAX-USD", "SUIUSD": "SUI20947-USD", "BTCUSD": "BTC-USD", "BNBUSD": "BNB-USD", "CASH": "CASH", "HYPEUSD": "HYPE32196-USD", "WIFUSD": "WIF-USD", "ADAUSD": "ADA-USD", "PEPEUSD": "PEPE-USD", "ETHUSD": "ETH-USD", "TRXUSD": "TRX-USD", "LINKUSD": "LINK-USD"}</script><script id="theme-crypto" type="application/json">{"bar": "rgba(63,63,70,0.25)", "alive_bg": "rgba(63,63,70,0.65)", "alive_fg": "#FFFFFF", "da_bg": "#6B7280", "da_fg": "#FFFFFF", "dead_bg": "#E5E7EB", "dead_fg": "#111111"}</script><script id="whitelist-crypto" type="application/json">["AVAXUSD", "BNBUSD", "BTCUSD", "DOGEUSD", "ETHUSD", "HYPEUSD", "LINKUSD", "SOLUSD", "SUIUSD", "XRPUSD"]</script>

      <script>
      (function(){
        const byId = (id) => document.getElementById(id);
        const el   = (sel) => document.querySelector(sel);
        const qsa  = (sel) => Array.from(document.querySelectorAll(sel));
        const fmtPct  = (x) => (x===null||x===undefined||isNaN(x)) ? "" : (x*100).toFixed(2)+"%";
        const fmtPct1 = (x) => (x===null||x===undefined||isNaN(x)) ? "" : (x*100).toFixed(1)+"%";
        const fmtSignedPct1 = (x) => (x===null||x===undefined||isNaN(x)) ? "" : ((x>=0?"+":"") + (x*100).toFixed(1) + "%");
        const arrowPct = (x) => {
          if (x===null||x===undefined||isNaN(x)) return "";
          if (x>0) return '<span class="arrow up">▲</span>'+fmtPct1(x);
          if (x<0) return '<span class="arrow down">▼</span>'+fmtPct1(x);
          return '<span class="arrow flat">—</span>'+fmtPct1(x);
        };
        const deltaHTML = (curr, prev) => {
          const p = (prev === undefined || prev === null || isNaN(prev)) ? 0 : prev;
          if (!Number.isFinite(curr) || !Number.isFinite(p)) return "";
          const d = curr - p;
          if (d > 0) return '<span class="arrow up">▲</span>' + fmtSignedPct1(d);
          if (d < 0) return '<span class="arrow down">▼</span>' + fmtSignedPct1(d);
          return '<span class="arrow flat">—</span>' + fmtSignedPct1(0);
        };

        const uniNames = ["Macro", "Crypto"];
        const slug = (s) => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
        const loads = (prefix) => Object.fromEntries(
          uniNames.map(n => [n, JSON.parse(byId(prefix+slug(n)).textContent)])
        );
        const universes = loads('payload-');
        const links     = loads('links-');
        const themes    = loads('theme-');
        const whitelists= loads('whitelist-'); // NEW

        const tabs = el('#tabs');
        uniNames.forEach((name, i) => {
          const b = document.createElement('button');
          b.className = 'tab-btn';
          b.setAttribute('role','tab');
          b.dataset.uni = name;
          b.textContent = name;
          if (i===0) b.setAttribute('aria-selected','true');
          tabs.appendChild(b);
        });

        function applyTheme(t){
          const r = document.documentElement.style;
          if (!t) return;
          if (t.bar)       r.setProperty('--bar-fill', t.bar);
          if (t.alive_bg)  r.setProperty('--alive-bg', t.alive_bg);
          if (t.alive_fg)  r.setProperty('--alive-fg', t.alive_fg);
          if (t.da_bg)     r.setProperty('--da-bg', t.da_bg);
          if (t.da_fg)     r.setProperty('--da-fg', t.da_fg);
          if (t.dead_bg)   r.setProperty('--dead-bg', t.dead_bg);
          if (t.dead_fg)   r.setProperty('--dead-fg', t.dead_fg);
        }

        function yahooFor(sym, map){
          const yf = map && map[sym];
          return yf ? yf : sym;
        }

        // Sorting helpers
        let currentSort = {key: 'weight', dir: 'desc'};
        function compareRows(a, b, key) {
          const av = parseFloat(a.dataset[key]); const bv = parseFloat(b.dataset[key]);
          if (!isNaN(av) && !isNaN(bv)) return av - bv;
          // fallback to string compare
          return String(a.dataset[key]||'').localeCompare(String(b.dataset[key]||''));
        }
        function applySort(tbody) {
            const rows = Array.from(tbody.querySelectorAll('tr'));
              rows.sort((ra, rb) => {
                // Pin CASH (dataset.pin = 1)
                const pa = parseInt(ra.dataset.pin || '0', 10);
                const pb = parseInt(rb.dataset.pin || '0', 10);
                if (pa !== pb) return pb - pa;
            
                const s = compareRows(ra, rb, currentSort.key);
                return currentSort.dir === 'asc' ? s : -s;
              });
              rows.forEach(r => tbody.appendChild(r));
        }

        // Search filter
        function applySearch(tbody, term) {
          const t = term.trim().toLowerCase();
          Array.from(tbody.querySelectorAll('tr')).forEach(tr => {
            const asset = (tr.dataset.asset || '').toLowerCase();
            tr.style.display = (!t || asset.includes(t)) ? '' : 'none';
          });
        }

        function renderUniverse(name){
          const payload   = universes[name];
          const linkMap   = links[name] || {};
          const theme     = themes[name] || null;
          const whitelist = new Set(whitelists[name] || []); // NEW
          applyTheme(theme);

          el('#asof').textContent = 'as of ' + (new Date(payload.weights_time)).toISOString().slice(0,10);

          const weights     = payload.weights || {};
          const prevWeights = payload.prev_weights || {};
          const meta        = payload.meta || {};
          const allSymbols  = Object.keys(meta).sort();

          // Exclude CASH from status counts/lists
          const tickers = allSymbols.filter(a => a !== 'CASH');

          const alive=[], da=[], dead=[];
          for (const a of tickers){
            const st = String((meta[a] && meta[a].state) || '').toLowerCase();
            if (st === 'alive (confirmed)') alive.push(a);
            else if (st === 'alive (candidate)') da.push(a);
            else dead.push(a);
          }
          el('#counts').textContent = `Alive: ${alive.length} · Dead and Alive: ${da.length} · Dead: ${dead.length}`;

          const fillList = (id, arr) => {
            const ul = el(id);
            ul.innerHTML = arr.map(a => {
              if (a === 'CASH') return '';
              const yf = yahooFor(a, linkMap);
              return `<li><a href="https://finance.yahoo.com/quote/${yf}" target="_blank" rel="noopener noreferrer">${a}</a></li>`;
            }).filter(Boolean).join('') || "<li><span class='muted'>None</span></li>";
          };
          fillList('#list-alive', alive);
          fillList('#list-da', da);
          fillList('#list-dead', dead);

          // BARS — Only whitelisted assets (plus CASH if present)
          const barsWrap = el('#bars-wrap');
          const entries = Object.entries(weights);
          const pairsAll = entries.sort((a,b)=> b[1]-a[1]);
          const pairs = pairsAll.filter(([a,_]) => (a === 'CASH') || (!whitelist.size || whitelist.has(a))); // NEW
          const allVals = pairs.map(([,w]) => Math.abs(w));
          for (const [a, pw] of Object.entries(prevWeights)) {
            if ((a === 'CASH') || (!whitelist.size || whitelist.has(a))) allVals.push(Math.abs(pw));
          }
          const maxW = allVals.length ? Math.max(...allVals) : 0;

          const mkBar = (asset, w) => {
            const pctNow  = maxW>0 ? Math.max(0, Math.min(100, Math.abs(w)/maxW*100)) : 0;
            const prev    = (prevWeights.hasOwnProperty(asset) ? prevWeights[asset] : 0);
            const pctPrev = maxW>0 ? Math.max(0, Math.min(100, Math.abs(prev)/maxW*100)) : 0;
            const marker  = Number.isFinite(pctPrev) ? `<div class="bar-prev-marker" style="left:${pctPrev}%;"></div>` : "";
            return `
              <div class="bar-row">
                <div class="bar-label">${asset}</div>
                <div class="bar-track">
                  <div class="bar-fill" style="width:${pctNow}%"></div>
                  ${marker}
                </div>
                <div class="right" style="width:60px">${fmtPct(w)}</div>
              </div>`;
          };
          barsWrap.innerHTML = pairs.length ? pairs.map(([a,w]) => mkBar(a, w)).join('') : `<div class="small muted">No current allocation.</div>`;

          // TABLE — All assets with signals (not just whitelist)
          const tbody = document.querySelector('#tbl-weights tbody');
          tbody.innerHTML = ""; // reset
          const mkRow = (asset, w) => {
            const m = meta[asset] || {};
            const isCash = (asset === 'CASH');

            let stateText = '', stateOrder = 3; // for sorting: alive=1, da=2, dead=3, cash=0
            if (!isCash) {
              const st = String(m.state || '').toLowerCase();
              if (st === 'alive (confirmed)') { stateText='Alive'; stateOrder=1; }
              else if (st === 'alive (candidate)') { stateText='Dead and Alive'; stateOrder=2; }
              else { stateText='Dead'; stateOrder=3; }
            } else {
              stateText=''; stateOrder=0;
            }

            const allocMark    = (!isCash && w > 0) ? '✓' : '';
            const expectedHTML = arrowPct(m.view_blend);
            const confHTML     = fmtPct1(m.view_conf);
            const yf           = yahooFor(asset, linkMap);
            const prev         = (prevWeights.hasOwnProperty(asset) ? prevWeights[asset] : 0);
            const dHTML        = deltaHTML(w, prev);

            const assetCell = isCash
              ? `<strong>${asset}</strong>`
              : `<a href="https://finance.yahoo.com/quote/${yf}" target="_blank" rel="noopener noreferrer"><strong>${asset}</strong></a>`;
            const stateCell = isCash ? '' :
              (stateText === 'Alive' ? '<span class="pill alive">Alive</span>' :
               stateText === 'Dead and Alive' ? '<span class="pill da">Dead and Alive</span>' :
               '<span class="pill dead">Dead</span>');

            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${assetCell}</td>
              <td>${stateCell}</td>
              <td class="center">${allocMark}</td>
              <td class="right">${fmtPct(w)}</td>
              <td class="right">${dHTML}</td>
              <td class="right">${expectedHTML}</td>
              <td class="right">${confHTML}</td>
            `;
            // dataset for sorting/search
            tr.dataset.asset    = asset;
            tr.dataset.state    = stateText;
            tr.dataset.stateord = String(stateOrder);
            tr.dataset.alloc    = allocMark ? '1' : '0';
            tr.dataset.weight   = isNaN(w) ? '' : String(w);
            tr.dataset.delta    = isNaN(w - prev) ? '' : String(w - prev);
            tr.dataset.expected = isNaN(m.view_blend) ? '' : String(m.view_blend);
            tr.dataset.conf     = isNaN(m.view_conf) ? '' : String(m.view_conf);
            tr.dataset.pin      = isCash ? '1' : '0';           // pin CASH
            return tr;
          };

          const inTable = new Set();

          // Always put CASH first if present
          if (allSymbols.includes('CASH')) {
            tbody.appendChild(mkRow('CASH', weights['CASH'] || 0));
            inTable.add('CASH');
          }

          // Then by current weights (desc)
          const pairsAllForTable = Object.entries(weights).sort((a,b)=> b[1]-a[1]);
          for (const [a, w] of pairsAllForTable) {
            if (a === 'CASH') continue;
            tbody.appendChild(mkRow(a, w));
            inTable.add(a);
          }

          // Finally the rest (weight=0)
          for (const a of allSymbols) {
            if (!inTable.has(a)) tbody.appendChild(mkRow(a, 0));
          }

          // Apply initial sort (by weight desc)
          currentSort = {key: 'weight', dir: 'desc'};
          applySort(tbody);
            
        
          // Search hookup
          const search = byId('asset-search');
          search.oninput = () => applySearch(tbody, search.value);

          // Sort hookup (clickable headers)
          const thead = document.querySelector('#tbl-weights thead');
          thead.onclick = (ev) => {
            const th = ev.target.closest('th[data-sort]');
            if (!th) return;
            const key = th.dataset.sort;
            // special mapping: state uses numeric order
            currentSort.key = (key === 'state') ? 'stateord' : key;
            currentSort.dir = (currentSort.key === key && currentSort.dir === 'asc') ? 'desc' : 'asc';
            applySort(tbody);
          };
        }

        // init
        renderUniverse(uniNames[0]);
        el('#tabs').addEventListener('click', (e) => {
          const btn = e.target.closest('.tab-btn');
          if (!btn) return;
          const name = btn.dataset.uni;
          qsa('.tab-btn').forEach(b => b.setAttribute('aria-selected', String(b===btn)));
          renderUniverse(name);
          // reset search when switching tabs (optional)
          const search = byId('asset-search'); if (search) { search.value = ""; }
        });
      })();
      </script>
    </body>
    </html>
    